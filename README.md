# AozoraEpub3

**Java 21対応版 / Gradle対応版**

青空文庫の注記入りテキストファイルを EPUB 3 ファイルに変換するツールです。

## 特徴

- 青空文庫テキスト（txt/zip）を EPUB 3.2 に変換
- Web小説サイトのHTMLから青空文庫形式テキストを取得して変換
- 画像zip/rarを EPUB 3 に変換
- 縦書き・横書きに対応
- 日本の主要電子書籍リーダー（Kobo, Kindle, Reader等）に対応
- Java 21 の最新機能を活用

---

## 動作環境

**Java 21以降** が必要です。

[Adoptium](https://adoptium.net/) から Java 21 をインストールしてください。

### 対応OS

- Windows 10 以降
- macOS
- Ubuntu

---

## インストール

1. `AozoraEpub3-*.zip` を任意のフォルダに解凍します。
2. `AozoraEpub3.jar` をダブルクリックまたは以下のコマンドで実行します：
   ```bash
   java -jar AozoraEpub3.jar
   ```

---

## 使い方（GUI）

### 基本的な流れ

1. **アプリケーション起動**
   - `AozoraEpub3.jar` をダブルクリック
   
2. **ファイル指定**
   - 変換したい青空文庫テキストファイル（`.txt` または `.zip`）をドラッグ&ドロップ
   - または「ファイル選択」から開く
   
3. **設定調整**（オプション）
   - 表題・著者名の抽出方法
   - 表紙画像の指定
   - 縦書き/横書きの選択
   - 出力形式（.epub / .kepub.epub など）
   
4. **変換実行**
   - 変換ボタンをクリック
   - 完了後、入力ファイルと同じフォルダに EPUB ファイルが生成されます

### Web小説サイトから直接変換

Web小説サイト（ニコニコ小説、小説家になろう など）のURLまたはURLショートカット（`.url`）をドラッグ&ドロップで取得・変換できます。（`web/` 以下に定義ファイルがあるサイトのみ）

---

## 主な設定項目

### 表題設定

- **本文内タイトル利用**：本文内からタイトルと著者名を抽出
- **ファイル名優先**：`[著作者名] 表題.epub` 形式のファイル名から取得

### 表紙

- **先頭の挿絵**：最初の画像を表紙に設定
- **ファイル名と同じ画像**：入力ファイル名と同じ画像ファイル（`.png` / `.jpg`）を表紙に設定
- **カスタム指定**：任意の画像ファイルまたはURLを指定

### ページ出力

- **表紙ページ**：ePubの先頭に表紙を追加
- **表題ページ**：タイトル・著者名ページを出力
- **目次ページ**：目次を生成して出力

### ファイル形式

| 拡張子 | 対応デバイス | 説明 |
|--------|------------|------|
| `.epub` | 標準 | 標準的な EPUB 3.2 形式 |
| `.kepub.epub` | Kobo | Kobo向け拡張形式 |
| `.fxl.kepub.epub` | Kobo | Kobo固定レイアウト用 |
| `.mobi` | Kindle | Kindle形式（kindlegenjの別途インストール必要） |

### 画像処理

- **挿絵除外**：テキスト内の挿絵を含めない
- **画像縮小**：端末のサイズ制限に合わせて縮小
- **余白除去**：画像の不要な余白を自動削除
- **回転対応**：端末の縦横比に合わせて自動回転

### 詳細設定

- **縦書き/横書き**：本文の方向を指定
- **強制改ページ**：長いファイルを複数に分割（Reader等で処理を軽くします）
- **自動縦中横**：半角数字と記号を縦に並べて表示
- **行の高さ/文字サイズ**：レイアウトを調整

---

## 変換時の注意

### テキスト修正が必要な場合

変換時のログに表示される以下の内容は、元のテキストを修正することをお勧めします：

- **コメントエラー**：不正な注記構文
- **外字変換エラー**：対応していない外字コード
- **仕様外の注記**

### 外字（がいじ）の取り扱い

青空文庫の注記仕様で定義された外字は自動変換します：
```
※［＃「字名」、U+XXXX］  → UTF-8に変換
※［＃「字名」、第X水準X-XX-XX］  → UTF-8に変換（対応表利用）
```

対応コードが無い外字は代替文字で出力します。

### 4バイト文字について

Koboなど一部の端末では、4バイト文字（絵文字など）が行内で表示されない制限があります。設定で「4バイト文字変換」を無効にすると、4バイト文字を代替文字「〓」で表示し、小書きで元の字を注記として表示します。

---

## コマンドライン実行

GUIを使わずにコマンドラインから実行できます。

```bash
java -jar AozoraEpub3.jar [オプション] 入力ファイル
```

### 主なオプション

| オプション | 説明 | 例 |
|----------|------|-----|
| `-h, --help` | ヘルプを表示 | |
| `-i <ファイル>` | INI設定ファイルを指定 | `-i settings.ini` |
| `-enc <エンコード>` | 入力ファイルのエンコード | `-enc UTF-8` |
| `-t <タイプ>` | タイトル抽出方法 | `-t 0` (0=本文内から抽出) |
| `-c <画像>` | 表紙指定 | `-c cover.jpg` |
| `-d <パス>` | 出力先ディレクトリ | `-d ./output/` |
| `-ext <拡張子>` | 出力ファイル拡張子 | `-ext .kepub.epub` |
| `-of` | ファイル名から表題を生成 | |

### 例

```bash
# 標準的な変換
java -jar AozoraEpub3.jar input.txt

# 出力先を指定
java -jar AozoraEpub3.jar -d ./books/ input.txt

# Kobo形式で出力
java -jar AozoraEpub3.jar -ext .kepub.epub input.txt

# 複数ファイルを一括変換
java -jar AozoraEpub3.jar *.txt
```

---

## トラブルシューティング

### 変換できない注記が多い

- 青空文庫の仕様外にある注記は対応していません
- ログに表示される注記を確認し、元のテキストを修正してください
- 対応している注記については、[DEVELOPMENT.md](DEVELOPMENT.md#対応している注記) を参照

### ファイルが開かない

- `java` コマンドがインストールされているか確認してください
- Java 21以降がインストールされているか確認（`java -version` で確認）

### 表示がおかしい

- 文字コード（エンコード）の指定を確認してください
- 青空文庫テキストは通常 MS932（Shift JIS）です
- UTF-8のテキストの場合は `-enc UTF-8` オプションで指定してください

### メモリ不足エラー

大きなファイルの場合、メモリを増やして実行してください：
```bash
java -Xmx2g -jar AozoraEpub3.jar input.txt
```

---

## ライセンス

### ソースコードおよびバイナリ

[GPL v3](http://www.gnu.org/licenses/gpl-3.0.html)

ソースコードの流用、改変、再配布を行った場合も GPL v3 が適用されます。

### 変換データ

AozoraEpub3で変換した ePubファイルの著作権は入力データと同一になります。  
ePubファイルの修正や配布は入力データの著作権内で自由に行うことができます。

---

## 更新履歴

詳細は [README_Changes.txt](README_Changes.txt) を参照してください。

---

## 開発への参加

バグ報告・機能提案・プルリクエストを歓迎します。  
詳細は [DEVELOPMENT.md](DEVELOPMENT.md) を参照してください。
