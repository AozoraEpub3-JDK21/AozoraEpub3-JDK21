# narou.rb å®Œå…¨äº’æ› å®Ÿè£…è¨ˆç”»æ›¸

**ä½œæˆæ—¥**: 2026-02-14
**ç›®çš„**: WebAozoraConverter.java ã‚’ narou.rb ã¨å®Œå…¨äº’æ›ã«ã™ã‚‹
**å¯¾è±¡ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: narou-3.8.2

---

## ğŸ“‹ å®Ÿè£…çŠ¶æ³ã‚µãƒãƒªãƒ¼

| ã‚«ãƒ†ã‚´ãƒª | ç·é …ç›®æ•° | å®Ÿè£…æ¸ˆ | æœªå®Ÿè£… | é€²æ—ç‡ |
|---------|---------|-------|-------|--------|
| è¨­å®šé …ç›® | 42 | 8 | 34 | 19% |
| å¤‰æ›å‡¦ç† | 20 | 3 | 17 | 15% |
| é’ç©ºæ³¨è¨˜ | 25 | 8 | 17 | 32% |
| **åˆè¨ˆ** | **87** | **19** | **68** | **22%** |

---

## ğŸ¯ Phase 1: ç·Šæ€¥ä¿®æ­£ï¼ˆè¡¨ç¤ºå´©ã‚Œè§£æ¶ˆï¼‰

### å„ªå…ˆåº¦: â˜…â˜…â˜… CRITICAL

### 1.1 æ”¹è¡Œå‡¦ç†ã®ä¿®æ­£

**å•é¡Œ**: HTMLæ”¹è¡Œã‚³ãƒ¼ãƒ‰ï¼ˆ\r\nï¼‰ãŒæ®‹ã‚Šã€brã‚¿ã‚°ã‚‚æ”¹è¡ŒåŒ–ã•ã‚Œã¦2é‡æ”¹è¡Œã«ãªã‚‹

**å‚è€ƒã‚³ãƒ¼ãƒ‰**: `narou-3.8.2/lib/html.rb:65-67`
```ruby
def br_to_aozora(text = @string)
  text.gsub(/[\r\n]+/, "").gsub(/<br.*?>/i, "\n")
end
```

**å®Ÿè£…ç®‡æ‰€**: `WebAozoraConverter.java`

**ã‚¿ã‚¹ã‚¯**:
- [ ] `printNode()` ãƒ¡ã‚½ãƒƒãƒ‰ã®å‰ã«ã€HTMLãƒ†ã‚­ã‚¹ãƒˆå…¨ä½“ã‹ã‚‰ `\r\n` ã‚’å‰Šé™¤ã™ã‚‹å‡¦ç†ã‚’è¿½åŠ 
- [ ] `<br>` ã‚¿ã‚°ã®ã¿ã‚’ `\n` ã«å¤‰æ›ã™ã‚‹æ—¢å­˜å‡¦ç†ã‚’ç¶­æŒ
- [ ] `<p>` ã‚¿ã‚°ã®çµ‚äº†ã‚¿ã‚° `</p>` ã‚‚æ”¹è¡Œã«å¤‰æ›ï¼ˆnarou.rbã® `p_to_aozora`ï¼‰

**å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«**:
```
src/com/github/hmdev/web/WebAozoraConverter.java
  - printNode() ãƒ¡ã‚½ãƒƒãƒ‰ä¿®æ­£
  - ã¾ãŸã¯ docToAozoraText() å†…ã§äº‹å‰å‡¦ç†
```

**ãƒ†ã‚¹ãƒˆæ–¹æ³•**:
1. ãªã‚ã†å°èª¬ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
2. converted.txt ã‚’ç¢ºèª
3. ç©ºç™½è¡ŒãŒ1ï½2è¡Œè¿½åŠ ã•ã‚Œã¦ã„ãªã„ã“ã¨ã‚’ç¢ºèª

---

### 1.2 è¡¨ç´™ã®æŒ¿çµµæ³¨è¨˜æŒ¿å…¥

**å•é¡Œ**:
- è¡¨ç´™ç”»åƒãŒ `converted.png` ã¨ã—ã¦ä¿å­˜ã•ã‚Œã¦ã„ã‚‹
- ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã«æŒ¿çµµæ³¨è¨˜ãŒæŒ¿å…¥ã•ã‚Œã¦ã„ãªã„
- AozoraEpub3ãŒæ¨ªæ›¸ãè¡¨ç´™ã‚’ç”Ÿæˆã§ããªã„

**å‚è€ƒã‚³ãƒ¼ãƒ‰**: `narou-3.8.2/lib/novelconverter.rb:547-568`
```ruby
def self.get_cover_filename(archive_path)
  [".jpg", ".png", ".jpeg"].each do |ext|
    filename = "cover#{ext}"
    cover_path = File.join(archive_path, filename)
    return filename if File.exist?(cover_path)
  end
  nil
end

def create_cover_chuki
  cover_filename = self.class.get_cover_filename(@setting.archive_path)
  if cover_filename
    "ï¼»ï¼ƒæŒ¿çµµï¼ˆ#{cover_filename}ï¼‰å…¥ã‚‹ï¼½"
  else
    ""
  end
end
```

**å®Ÿè£…ç®‡æ‰€**: `WebAozoraConverter.java:434-487`

**ã‚¿ã‚¹ã‚¯**:
- [ ] è¡¨ç´™ç”»åƒã®ãƒ•ã‚¡ã‚¤ãƒ«åã‚’ `converted.png` â†’ `cover.jpg` ã«å¤‰æ›´
  - ã¾ãŸã¯ `cover.png` ã«å¤‰æ›´ï¼ˆå…ƒã®å½¢å¼ã‚’ç¶­æŒï¼‰
- [ ] ã‚¿ã‚¤ãƒˆãƒ«ãƒ»è‘—è€…ã®æ¬¡ã®è¡Œï¼ˆ3è¡Œç›®ï¼‰ã« `ï¼»ï¼ƒæŒ¿çµµï¼ˆcover.jpgï¼‰å…¥ã‚‹ï¼½` ã‚’æŒ¿å…¥
- [ ] æŒ¿çµµæ³¨è¨˜ã®å¾Œã«æ”¹è¡Œã‚’è¿½åŠ 

**å¤‰æ›´ç®‡æ‰€**:
```java
// WebAozoraConverter.java:434
File coverImageFile = new File(this.dstPath+"cover.jpg");  // ä¿®æ­£

// WebAozoraConverter.java:535 ä»˜è¿‘ï¼ˆè‘—è€…ã®å¾Œï¼‰
bw.append('\n');

// â˜…â˜…â˜… ã“ã“ã«è¿½åŠ  â˜…â˜…â˜…
if (coverImageFile.exists()) {
    bw.append("ï¼»ï¼ƒæŒ¿çµµï¼ˆcover.jpgï¼‰å…¥ã‚‹ï¼½\n");
    bw.append('\n');
}
```

**ãƒ†ã‚¹ãƒˆæ–¹æ³•**:
1. converted.txt ã®3è¡Œç›®ã« `ï¼»ï¼ƒæŒ¿çµµï¼ˆcover.jpgï¼‰å…¥ã‚‹ï¼½` ãŒã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
2. cover.jpg ãŒå‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«å­˜åœ¨ã™ã‚‹ã“ã¨ã‚’ç¢ºèª
3. AozoraEpub3ã§EPUBåŒ–ã—ã¦è¡¨ç´™ãŒæ¨ªæ›¸ãã«ãªã‚‹ã“ã¨ã‚’ç¢ºèª

---

### 1.3 ãƒ«ãƒ“å‡¦ç†ã®å®Œå…¨å®Ÿè£…

**å•é¡Œ**: HTMLã® `<ruby>` ã‚¿ã‚°ãŒé’ç©ºæ–‡åº«å½¢å¼ã«å¤‰æ›ã•ã‚Œã¦ã„ãªã„

**å‚è€ƒã‚³ãƒ¼ãƒ‰**: `narou-3.8.2/lib/html.rb:74-83`
```ruby
def ruby_to_aozora(text = @string)
  text.tr("ã€Šã€‹", "â‰ªâ‰«")  # æ—¢å­˜ã®å±±æ‹¬å¼§ã‚’é€€é¿
      .gsub(/<ruby>(.+?)<\/ruby>/i) do
    splited_ruby = $1.split(/<rt>/i)
    next delete_tag(splited_ruby[0]) unless splited_ruby[1]
    ruby_base = delete_tag(splited_ruby[0].split(/<rp>/i)[0])
    ruby_text = delete_tag(splited_ruby[1].split(/<rp>/i)[0])
    "ï½œ#{ruby_base}ã€Š#{ruby_text}ã€‹"
  end
end
```

**å®Ÿè£…ç®‡æ‰€**:
- `WebAozoraConverter.java:1204-1220` (printRuby ãƒ¡ã‚½ãƒƒãƒ‰)
- æ–°è¦ãƒ¡ã‚½ãƒƒãƒ‰è¿½åŠ ãŒå¿…è¦

**ã‚¿ã‚¹ã‚¯**:
- [ ] HTMLãƒ†ã‚­ã‚¹ãƒˆå…¨ä½“ã«å¯¾ã—ã¦äº‹å‰å‡¦ç†ã™ã‚‹ `convertRubyTags()` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½åŠ 
- [ ] æ—¢å­˜ã® `ã€Šã€‹` ã‚’ `â‰ªâ‰«` ã«é€€é¿
- [ ] `<ruby>` ã‚¿ã‚°ã‚’æ­£è¦è¡¨ç¾ã§æ¤œå‡º
- [ ] `<rb>` ã¾ãŸã¯æœ€åˆã®è¦ç´ ã‚’è¦ªæ–‡å­—ã¨ã—ã¦æŠ½å‡º
- [ ] `<rt>` ã‚’æŒ¯ã‚Šä»®åã¨ã—ã¦æŠ½å‡º
- [ ] `ï½œè¦ªæ–‡å­—ã€Šãµã‚ŠãŒãªã€‹` å½¢å¼ã«å¤‰æ›
- [ ] `<rp>` ã‚¿ã‚°ã¯ç„¡è¦–

**å¤‰æ›´ç®‡æ‰€**:
```java
// WebAozoraConverter.java ã«è¿½åŠ 

/**
 * HTMLã®rubyã‚¿ã‚°ã‚’é’ç©ºæ–‡åº«å½¢å¼ã®ãƒ«ãƒ“ã«å¤‰æ›
 */
private String convertRubyTags(String html) {
    // æ—¢å­˜ã®ã€Šã€‹ã‚’â‰ªâ‰«ã«é€€é¿
    html = html.replace("ã€Š", "â‰ª").replace("ã€‹", "â‰«");

    // <ruby>ã‚¿ã‚°ã‚’å‡¦ç†
    Pattern rubyPattern = Pattern.compile("<ruby>(.+?)</ruby>", Pattern.CASE_INSENSITIVE);
    Matcher matcher = rubyPattern.matcher(html);
    StringBuffer result = new StringBuffer();

    while (matcher.find()) {
        String rubyContent = matcher.group(1);

        // <rt>ã‚¿ã‚°ã§åˆ†å‰²
        String[] parts = rubyContent.split("<rt>", 2);
        if (parts.length < 2) {
            // rtã‚¿ã‚°ãŒãªã„å ´åˆã¯ã‚¿ã‚°ã‚’å‰Šé™¤ã—ã¦å…ƒã®ãƒ†ã‚­ã‚¹ãƒˆã®ã¿
            matcher.appendReplacement(result,
                Matcher.quoteReplacement(removeHtmlTags(parts[0])));
            continue;
        }

        // è¦ªæ–‡å­—ï¼ˆ<rb>ã¾ãŸã¯æœ€åˆã®è¦ç´ ï¼‰
        String rubyBase = removeHtmlTags(parts[0].split("<rp>")[0]);
        // æŒ¯ã‚Šä»®åï¼ˆ<rt>ã®å†…å®¹ï¼‰
        String rubyText = removeHtmlTags(parts[1].split("<rp>")[0].split("</rt>")[0]);

        // é’ç©ºæ–‡åº«å½¢å¼ã«å¤‰æ›
        String aozoraRuby = "ï½œ" + rubyBase + "ã€Š" + rubyText + "ã€‹";
        matcher.appendReplacement(result, Matcher.quoteReplacement(aozoraRuby));
    }
    matcher.appendTail(result);

    return result.toString();
}

private String removeHtmlTags(String text) {
    return text.replaceAll("<[^>]+>", "");
}
```

**å‘¼ã³å‡ºã—ç®‡æ‰€**:
```java
// docToAozoraText() ãƒ¡ã‚½ãƒƒãƒ‰å†…ã€Jsoup.parse() ã®ç›´å¾Œ
Document chapterDoc = Jsoup.parse(chapterCacheFile, null);

// â˜…â˜…â˜… ã“ã“ã§å…¨ä½“ã®HTMLã‚’å¤‰æ› â˜…â˜…â˜…
String htmlContent = chapterDoc.html();
htmlContent = convertRubyTags(htmlContent);
chapterDoc = Jsoup.parse(htmlContent);
```

ã¾ãŸã¯ã€å€‹åˆ¥ã®ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡ºæ™‚ã«å¤‰æ›ï¼š
```java
// getExtractText() ãƒ¡ã‚½ãƒƒãƒ‰å†…
String text = getExtractText(doc, this.queryMap.get(ExtractId.TITLE));
if (text != null) {
    text = convertRubyTags(text);  // â˜…è¿½åŠ 
    printText(bw, text);
}
```

**ãƒ†ã‚¹ãƒˆæ–¹æ³•**:
1. ãƒ«ãƒ“ä»˜ãã®å°èª¬ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
2. converted.txt ã§ `ï½œæ¼¢å­—ã€Šã‹ã‚“ã˜ã€‹` å½¢å¼ã«ãªã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
3. æ—¢å­˜ã® `ã€Šã€‹` ãŒ `â‰ªâ‰«` ã«å¤‰æ›ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª

---

## ğŸ”§ Phase 2: å“è³ªå‘ä¸Šï¼ˆè¦‹ãŸç›®ã®æ”¹å–„ï¼‰

### å„ªå…ˆåº¦: â˜…â˜… HIGH

### 2.1 ã‹ãæ‹¬å¼§ã®äºŒåˆ†ã‚¢ã‚­

**å‚è€ƒã‚³ãƒ¼ãƒ‰**: `narou-3.8.2/lib/converterbase.rb:1412-1414`
```ruby
HALF_INDENT_TARGET = /^[ ã€€\t]*((?:[ã€”ã€Œã€(ï¼ˆã€ã€ˆã€Šâ‰ªã€])|(?:â€»ï¼»ï¼ƒå§‹ã‚äºŒé‡å±±æ‹¬å¼§ï¼½))/

def half_indent_bracket(data)
  data.gsub!(HALF_INDENT_TARGET) { "ï¼»ï¼ƒäºŒåˆ†ã‚¢ã‚­ï¼½#{$1}" }
end
```

**ã‚¿ã‚¹ã‚¯**:
- [ ] è¡Œé ­ã®ã‹ãæ‹¬å¼§é¡ï¼ˆã€Œã€ã€”ï¼ˆã€ã€ˆã€Šâ‰ªï¼‰ã®å‰ã« `ï¼»ï¼ƒäºŒåˆ†ã‚¢ã‚­ï¼½` ã‚’æŒ¿å…¥
- [ ] æ—¢å­˜ã®ç©ºç™½ï¼ˆå…¨è§’ãƒ»åŠè§’ãƒ»ã‚¿ãƒ–ï¼‰ã¯å‰Šé™¤
- [ ] setting.ini ã® `enable_half_indent_bracket` ã«å¯¾å¿œ

**å®Ÿè£…ãƒ¡ã‚½ãƒƒãƒ‰**:
```java
private String addHalfIndentBracket(String text) {
    if (!formatSettings.isEnableHalfIndentBracket()) {
        return text;
    }

    // è¡Œé ­ã®ç©ºç™½ + ã‹ãæ‹¬å¼§é¡
    Pattern pattern = Pattern.compile("^[ ã€€\\t]*([ã€Œã€ã€”ï¼ˆã€ã€ˆã€Šâ‰ªã€])", Pattern.MULTILINE);
    return pattern.matcher(text).replaceAll("ï¼»ï¼ƒäºŒåˆ†ã‚¢ã‚­ï¼½$1");
}
```

**è¨­å®šè¿½åŠ **:
```java
// NarouFormatSettings.java
private boolean enableHalfIndentBracket = true;

public boolean isEnableHalfIndentBracket() {
    return enableHalfIndentBracket;
}
```

---

### 2.2 è‹±æ–‡ã®åŠè§’ä¿è­·

**å‚è€ƒã‚³ãƒ¼ãƒ‰**: `narou-3.8.2/lib/converterbase.rb:253-282`
```ruby
ENGLISH_SENTENCES_CHARACTERS = /[\w.,!?'" &:;_-]+/
ENGLISH_SENTENCES_MIN_LENGTH = 8

def alphabet_to_zenkaku(data, force = false)
  data.gsub!(ENGLISH_SENTENCES_CHARACTERS) do |match|
    if sentence?(match) || should_word_be_hankaku?(match)
      @english_sentences << match
      "ï¼»ï¼ƒè‹±æ–‡ï¼#{@english_sentences.size - 1}ï¼½"
    else
      zenkaku(match)
    end
  end
end

def sentence?(str)
  return false if str.length < ENGLISH_SENTENCES_MIN_LENGTH
  str =~ /[a-zA-Z]{2,}/ && str =~ /[\s.,]/
end

def rebuild_english_sentences(data)
  @english_sentences.each_with_index do |eng, id|
    data.sub!("ï¼»ï¼ƒè‹±æ–‡ï¼#{convert_numbers(id.to_s)}ï¼½", eng)
  end
end
```

**ã‚¿ã‚¹ã‚¯**:
- [ ] 8æ–‡å­—ä»¥ä¸Šã®è‹±æ–‡ï¼ˆã‚¹ãƒšãƒ¼ã‚¹ãƒ»ã‚«ãƒ³ãƒãƒ»ãƒ”ãƒªã‚ªãƒ‰å«ã‚€ï¼‰ã‚’æ¤œå‡º
- [ ] ä¸€æ™‚çš„ã« `ï¼»ï¼ƒè‹±æ–‡ï¼Nï¼½` ã«ç½®æ›ã—ã¦ä¿è­·
- [ ] ä»–ã®å¤‰æ›å‡¦ç†å¾Œã«å…ƒã«æˆ»ã™

**å®Ÿè£…**:
```java
private List<String> englishSentences = new ArrayList<>();

private String protectEnglishSentences(String text) {
    Pattern pattern = Pattern.compile("[\\w.,!?'\" &:;_-]+");
    Matcher matcher = pattern.matcher(text);
    StringBuffer result = new StringBuffer();

    while (matcher.find()) {
        String match = matcher.group();
        if (isEnglishSentence(match)) {
            englishSentences.add(match);
            matcher.appendReplacement(result,
                "ï¼»ï¼ƒè‹±æ–‡ï¼" + (englishSentences.size() - 1) + "ï¼½");
        } else {
            // å…¨è§’åŒ–
            matcher.appendReplacement(result,
                Matcher.quoteReplacement(toZenkaku(match)));
        }
    }
    matcher.appendTail(result);
    return result.toString();
}

private boolean isEnglishSentence(String str) {
    if (str.length() < 8) return false;
    return str.matches(".*[a-zA-Z]{2,}.*") &&
           str.matches(".*[\\s.,].*");
}

private String rebuildEnglishSentences(String text) {
    for (int i = 0; i < englishSentences.size(); i++) {
        text = text.replace("ï¼»ï¼ƒè‹±æ–‡ï¼" + i + "ï¼½", englishSentences.get(i));
    }
    return text;
}
```

---

### 2.3 ç¸¦ä¸­æ¨ªå‡¦ç†

**å‚è€ƒã‚³ãƒ¼ãƒ‰**: `narou-3.8.2/lib/converterbase.rb:384-423`
```ruby
def convert_tatechuyoko(data)
  # æ„Ÿå˜†ç¬¦ãƒ»ç–‘å•ç¬¦ã®çµ„ã¿åˆã‚ã›
  data.gsub!(/ï¼+/) do |match|
    case match.length
    when 2
      tcy("!!")
    when 3
      tcy("!!!")
    end
  end

  data.gsub!(/[ï¼ï¼Ÿ]+/) do |match|
    case match.length
    when 2
      tcy(match.tr("ï¼ï¼Ÿ", "!?"))
    when 3
      if %w(ï¼ï¼ï¼Ÿ ï¼Ÿï¼ï¼).include?(match)
        tcy(match.tr("ï¼ï¼Ÿ", "!?"))
      end
    end
  end
end

def tcy(str)
  "ï¼»ï¼ƒç¸¦ä¸­æ¨ªï¼½#{str}ï¼»ï¼ƒç¸¦ä¸­æ¨ªçµ‚ã‚ã‚Šï¼½"
end
```

**ã‚¿ã‚¹ã‚¯**:
- [ ] 2ï½3å€‹ã® `ï¼` ã‚’ç¸¦ä¸­æ¨ªåŒ–
- [ ] 2ï½3å€‹ã® `ï¼ï¼Ÿ` ã®çµ„ã¿åˆã‚ã›ã‚’ç¸¦ä¸­æ¨ªåŒ–
- [ ] 2æ¡ã®æ•°å­—ã‚’ç¸¦ä¸­æ¨ªåŒ–ï¼ˆå¾Œã§å®Ÿè£…ï¼‰

**å®Ÿè£…**:
```java
private String convertTatechuyoko(String text) {
    // ï¼ï¼ã€ï¼ï¼ï¼
    text = text.replaceAll("ï¼{2}", "ï¼»ï¼ƒç¸¦ä¸­æ¨ªï¼½!!ï¼»ï¼ƒç¸¦ä¸­æ¨ªçµ‚ã‚ã‚Šï¼½");
    text = text.replaceAll("ï¼{3}", "ï¼»ï¼ƒç¸¦ä¸­æ¨ªï¼½!!!ï¼»ï¼ƒç¸¦ä¸­æ¨ªçµ‚ã‚ã‚Šï¼½");

    // ï¼ï¼Ÿã®çµ„ã¿åˆã‚ã›ï¼ˆ2å€‹ï¼‰
    text = text.replaceAll("ï¼ï¼", "ï¼»ï¼ƒç¸¦ä¸­æ¨ªï¼½!!ï¼»ï¼ƒç¸¦ä¸­æ¨ªçµ‚ã‚ã‚Šï¼½");
    text = text.replaceAll("ï¼ï¼Ÿ", "ï¼»ï¼ƒç¸¦ä¸­æ¨ªï¼½!?ï¼»ï¼ƒç¸¦ä¸­æ¨ªçµ‚ã‚ã‚Šï¼½");
    text = text.replaceAll("ï¼Ÿï¼", "ï¼»ï¼ƒç¸¦ä¸­æ¨ªï¼½?!ï¼»ï¼ƒç¸¦ä¸­æ¨ªçµ‚ã‚ã‚Šï¼½");
    text = text.replaceAll("ï¼Ÿï¼Ÿ", "ï¼»ï¼ƒç¸¦ä¸­æ¨ªï¼½??ï¼»ï¼ƒç¸¦ä¸­æ¨ªçµ‚ã‚ã‚Šï¼½");

    // 3å€‹ã®çµ„ã¿åˆã‚ã›ï¼ˆç‰¹å®šãƒ‘ã‚¿ãƒ¼ãƒ³ã®ã¿ï¼‰
    text = text.replaceAll("ï¼ï¼ï¼Ÿ", "ï¼»ï¼ƒç¸¦ä¸­æ¨ªï¼½!!?ï¼»ï¼ƒç¸¦ä¸­æ¨ªçµ‚ã‚ã‚Šï¼½");
    text = text.replaceAll("ï¼Ÿï¼ï¼", "ï¼»ï¼ƒç¸¦ä¸­æ¨ªï¼½?!!ï¼»ï¼ƒç¸¦ä¸­æ¨ªçµ‚ã‚ã‚Šï¼½");

    return text;
}
```

---

## ğŸ—ï¸ Phase 3: é«˜åº¦ãªå¤‰æ›ï¼ˆå®Œå…¨äº’æ›ï¼‰

### å„ªå…ˆåº¦: â˜… MEDIUM

### 3.1 æ•°å­—ã®æ¼¢æ•°å­—åŒ–

**å‚è€ƒã‚³ãƒ¼ãƒ‰**: `narou-3.8.2/lib/converterbase.rb:93-232`

**è¨­å®šé …ç›®**:
```ini
enable_convert_num_to_kanji = true
enable_kanji_num_with_units = true
kanji_num_with_units_lower_digit_zero = 2
```

**å‡¦ç†ãƒ•ãƒ­ãƒ¼**:
1. æ—¢å­˜ã®æ¼¢æ•°å­—ã‚’ä¸€æ™‚é€€é¿ï¼ˆ`ï¼»ï¼ƒæ¼¢æ•°å­—ï¼Nï¼½`ï¼‰
2. ã‚¢ãƒ©ãƒ“ã‚¢æ•°å­—ã‚’æ¼¢æ•°å­—ã«å¤‰æ›ï¼ˆ`123` â†’ `ä¸€äºŒä¸‰`ï¼‰
3. ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã®æ•°å­—ã¯åŠè§’ä¿è­·ï¼ˆ`1,000` â†’ `ï¼»ï¼ƒåŠè§’æ•°å­—ï¼Nï¼½`ï¼‰
4. åƒãƒ»ä¸‡ãªã©ã®å˜ä½åŒ–ï¼ˆ`1000` â†’ `åƒ`ã€`10000` â†’ `ä¸€ä¸‡`ï¼‰
5. é€€é¿ã—ãŸæ¼¢æ•°å­—ã‚’å¾©å…ƒ

**å®Ÿè£…ã‚¿ã‚¹ã‚¯**:
- [ ] `convertNumbersToKanji()` ãƒ¡ã‚½ãƒƒãƒ‰å®Ÿè£…
- [ ] `stashKanjiNum()` - æ—¢å­˜æ¼¢æ•°å­—ã®é€€é¿
- [ ] `arabicToKanji()` - ã‚¢ãƒ©ãƒ“ã‚¢æ•°å­—â†’æ¼¢æ•°å­—
- [ ] `addKanjiUnits()` - åƒãƒ»ä¸‡ãªã©ã®å˜ä½è¿½åŠ 
- [ ] `rebuildKanjiNum()` - é€€é¿ã—ãŸæ¼¢æ•°å­—ã‚’å¾©å…ƒ

**NarouFormatSettings.java ã«è¿½åŠ **:
```java
private boolean enableConvertNumToKanji = false;
private boolean enableKanjiNumWithUnits = false;
private int kanjiNumWithUnitsLowerDigitZero = 2;
```

**å®Ÿè£…ã®è¤‡é›‘åº¦**: é«˜ï¼ˆ100è¡Œä»¥ä¸Šã®ã‚³ãƒ¼ãƒ‰ï¼‰

---

### 3.2 å‰æ›¸ããƒ»å¾Œæ›¸ãã®è‡ªå‹•æ¤œå‡º

**å‚è€ƒã‚³ãƒ¼ãƒ‰**: `narou-3.8.2/lib/converterbase.rb:731-844`

**æ¤œå‡ºãƒ‘ã‚¿ãƒ¼ãƒ³**:
```ruby
AUTHOR_INTRODUCTION_SPLITTER = /^ã€€*[\*ï¼Š]{44}$/    # å‰æ›¸ãï¼ˆ*44å€‹ï¼‰
AUTHOR_POSTSCRIPT_SPLITTER = /^ã€€*[\*ï¼Š]{48}$/      # å¾Œæ›¸ãï¼ˆ*48å€‹ï¼‰
```

**é’ç©ºæ³¨è¨˜**:
```
ï¼»ï¼ƒã“ã“ã‹ã‚‰å‰æ›¸ãï¼½
å‰æ›¸ãã®å†…å®¹
ï¼»ï¼ƒã“ã“ã§å‰æ›¸ãçµ‚ã‚ã‚Šï¼½

ï¼»ï¼ƒã“ã“ã‹ã‚‰å¾Œæ›¸ãï¼½
å¾Œæ›¸ãã®å†…å®¹
ï¼»ï¼ƒã“ã“ã§å¾Œæ›¸ãçµ‚ã‚ã‚Šï¼½
```

**å®Ÿè£…ã‚¿ã‚¹ã‚¯**:
- [ ] ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›æ™‚ã®ã¿æœ‰åŠ¹
- [ ] `*` ãŒ44å€‹ã®è¡Œã®å¾Œã‚’å‰æ›¸ãã¨ã—ã¦æ¤œå‡º
- [ ] `*` ãŒ48å€‹ã®è¡Œã®å¾Œã‚’å¾Œæ›¸ãã¨ã—ã¦æ¤œå‡º
- [ ] é’ç©ºæ³¨è¨˜ã§å›²ã‚€

**NarouFormatSettings.java ã«è¿½åŠ **:
```java
private boolean enableAuthorComments = true;
```

---

### 3.3 è¨˜å·ã®å…¨è§’åŒ–ã¨ç‰¹æ®Šå¤‰æ›

**å‚è€ƒã‚³ãƒ¼ãƒ‰**: `narou-3.8.2/lib/converterbase.rb:340-383`

**å¤‰æ›ãƒªã‚¹ãƒˆ**:
```
- â†’ ï¼ï¼ˆå…¨è§’ãƒã‚¤ãƒ•ãƒ³ï¼‰
= â†’ ï¼
+ â†’ ï¼‹
/ â†’ ï¼
* â†’ ï¼Š
< â†’ ã€ˆ
> â†’ ã€‰
( â†’ ï¼ˆ
) â†’ ï¼‰
| â†’ ï½œ
, â†’ ï¼Œ
. â†’ ï¼
_ â†’ ï¼¿
; â†’ ï¼›
: â†’ ï¼š
[ â†’ ï¼»
] â†’ ï¼½
{ â†’ ï½›
} â†’ ï½
\ â†’ ï¿¥
â‰ª â†’ â€»ï¼»ï¼ƒå§‹ã‚äºŒé‡å±±æ‹¬å¼§ï¼½
â‰« â†’ â€»ï¼»ï¼ƒçµ‚ã‚ã‚ŠäºŒé‡å±±æ‹¬å¼§ï¼½
â€»â€» â†’ â€»ï¼»ï¼ƒç±³å°ã€1-2-8ï¼½
```

**å®Ÿè£…ã‚¿ã‚¹ã‚¯**:
- [ ] `convertSymbolsToZenkaku()` ãƒ¡ã‚½ãƒƒãƒ‰å®Ÿè£…
- [ ] è‹±æ–‡ä¿è­·ã‚¨ãƒªã‚¢å†…ã¯å¤‰æ›ã—ãªã„

---

### 3.4 è‡ªå‹•è¡Œé ­å­—ä¸‹ã’

**å‚è€ƒã‚³ãƒ¼ãƒ‰**: `narou-3.8.2/lib/converterbase.rb:1031-1094`

**å‡¦ç†å†…å®¹**:
- æ®µè½ã®é–‹å§‹ã‚’æ¤œå‡º
- æ—¢ã«å­—ä¸‹ã’ã•ã‚Œã¦ã„ã‚‹ã‹ã‚’åˆ¤å®š
- å¿…è¦ã«å¿œã˜ã¦ `ï¼»ï¼ƒåœ°ã‹ã‚‰ï¼‘å­—ä¸Šã’ï¼½` ãªã©ã®æ³¨è¨˜ã‚’æŒ¿å…¥

**å®Ÿè£…ã®è¤‡é›‘åº¦**: é«˜ï¼ˆè¡Œã®å‰å¾Œé–¢ä¿‚ã‚’åˆ†æï¼‰

**NarouFormatSettings.java ã«è¿½åŠ **:
```java
private boolean enableAutoIndent = false;
```

---

### 3.5 ã‹ãæ‹¬å¼§å†…ã®è‡ªå‹•é€£çµ

**å‚è€ƒã‚³ãƒ¼ãƒ‰**: `narou-3.8.2/lib/converterbase.rb:520-609`

**å‡¦ç†å†…å®¹**:
```
å…ƒã®ãƒ†ã‚­ã‚¹ãƒˆ:
ã€Œã“ã‚Œã¯
ã€€ãƒ†ã‚¹ãƒˆã§ã™ã€

å¤‰æ›å¾Œ:
ã€Œã“ã‚Œã¯ã€€ãƒ†ã‚¹ãƒˆã§ã™ã€
```

**å®Ÿè£…ã‚¿ã‚¹ã‚¯**:
- [ ] ã‹ãæ‹¬å¼§ã®é–‹ãã‹ã‚‰é–‰ã˜ã¾ã§ã‚’æ¤œå‡º
- [ ] é€”ä¸­ã®æ”¹è¡Œã‚’å…¨è§’ã‚¹ãƒšãƒ¼ã‚¹ã«ç½®æ›
- [ ] ãƒã‚¹ãƒˆã—ãŸã‹ãæ‹¬å¼§ã«ã‚‚å¯¾å¿œ

**NarouFormatSettings.java ã«è¿½åŠ **:
```java
private boolean enableAutoJoinInBrackets = false;
```

---

### 3.6 è¡Œæœ«èª­ç‚¹ã§ã®è‡ªå‹•é€£çµ

**å‚è€ƒã‚³ãƒ¼ãƒ‰**: `narou-3.8.2/lib/converterbase.rb:611-667`

**å‡¦ç†å†…å®¹**:
```
å…ƒã®ãƒ†ã‚­ã‚¹ãƒˆ:
ã“ã‚Œã¯ãƒ†ã‚¹ãƒˆã§ã™ã€
æ¬¡ã®è¡Œã«ç¶šãã¾ã™ã€‚

å¤‰æ›å¾Œ:
ã“ã‚Œã¯ãƒ†ã‚¹ãƒˆã§ã™ã€æ¬¡ã®è¡Œã«ç¶šãã¾ã™ã€‚
```

**å®Ÿè£…ã‚¿ã‚¹ã‚¯**:
- [ ] è¡Œæœ«ãŒèª­ç‚¹ï¼ˆã€ï¼‰ã§çµ‚ã‚ã‚‹è¡Œã‚’æ¤œå‡º
- [ ] æ¬¡ã®è¡Œã¨é€£çµ
- [ ] ã‹ãæ‹¬å¼§å†…ã‚„ç‰¹æ®ŠãªçŠ¶æ³ã§ã¯é€£çµã—ãªã„

**NarouFormatSettings.java ã«è¿½åŠ **:
```java
private boolean enableAutoJoinLine = false;
```

---

### 3.7 ãƒ­ãƒ¼ãƒæ•°å­—ã®å¤‰æ›

**å‚è€ƒã‚³ãƒ¼ãƒ‰**: `narou-3.8.2/lib/converterbase.rb:331-338`

**å¤‰æ›ãƒªã‚¹ãƒˆ**:
```
â…  â†’ I
â…¡ â†’ II
â…¢ â†’ III
...
â…° â†’ i
â…± â†’ ii
```

**å®Ÿè£…ã‚¿ã‚¹ã‚¯**:
- [ ] ãƒ¦ãƒ‹ã‚³ãƒ¼ãƒ‰ã®ãƒ­ãƒ¼ãƒæ•°å­—ã‚’é€šå¸¸ã®ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆã«å¤‰æ›
- [ ] ãã®å¾Œã€è‹±æ–‡ä¿è­·ã®å‡¦ç†ã§å…¨è§’åŒ–ã¾ãŸã¯ä¿è­·

---

### 3.8 åˆ†æ•°ãƒ»æ—¥ä»˜ã®å¤‰æ›

**å‚è€ƒã‚³ãƒ¼ãƒ‰**: `narou-3.8.2/lib/converterbase.rb:265-329`

**åˆ†æ•°å¤‰æ›**:
```
1/2 â†’ 2åˆ†ã®1
3/4 â†’ 4åˆ†ã®3
```

**æ—¥ä»˜å¤‰æ›**:
```
2024/1/1 â†’ 2024å¹´1æœˆ1æ—¥ï¼ˆdate_formatã«å¾“ã†ï¼‰
```

**å®Ÿè£…ã‚¿ã‚¹ã‚¯**:
- [ ] `enable_transform_fraction` è¨­å®š
- [ ] `enable_transform_date` è¨­å®š
- [ ] `date_format` è¨­å®šï¼ˆSimpleDateFormatå½¢å¼ï¼‰

**NarouFormatSettings.java ã«è¿½åŠ **:
```java
private boolean enableTransformFraction = false;
private boolean enableTransformDate = false;
private String dateFormat = "%Yå¹´%mæœˆ%dæ—¥";
```

---

### 3.9 ä¸‰ç‚¹ãƒªãƒ¼ãƒ€ãƒ¼ã®å¤‰æ›

**å‚è€ƒã‚³ãƒ¼ãƒ‰**: `narou-3.8.2/lib/converterbase.rb:1032-1053`

**å‡¦ç†å†…å®¹**:
```
ãƒ»ãƒ»ãƒ» â†’ â€¦â€¦
ãƒ»ãƒ»ãƒ»ãƒ»ãƒ»ãƒ» â†’ â€¦â€¦â€¦
```

**å®Ÿè£…ã‚¿ã‚¹ã‚¯**:
- [ ] ä¸­é»’ï¼ˆãƒ»ï¼‰ãŒ3ã¤ä»¥ä¸Šé€£ç¶šã—ã¦ã„ã‚‹å ´åˆã€ä¸‰ç‚¹ãƒªãƒ¼ãƒ€ãƒ¼ï¼ˆâ€¦ï¼‰ã«å¤‰æ›
- [ ] 2å€‹ã”ã¨ã«1ã¤ã®ä¸‰ç‚¹ãƒªãƒ¼ãƒ€ãƒ¼

**NarouFormatSettings.java ã«è¿½åŠ **:
```java
private boolean enableConvertHorizontalEllipsis = false;
```

---

### 3.10 æ¿ç‚¹ãƒ•ã‚©ãƒ³ãƒˆã®å‡¦ç†

**å‚è€ƒã‚³ãƒ¼ãƒ‰**: `narou-3.8.2/lib/converterbase.rb:470-476`

**å‡¦ç†å†…å®¹**:
```
ã‹ã‚› â†’ ï¼»ï¼ƒæ¿ç‚¹ï¼½ã‹ï¼»ï¼ƒæ¿ç‚¹çµ‚ã‚ã‚Šï¼½
```

**å®Ÿè£…ã‚¿ã‚¹ã‚¯**:
- [ ] ã²ã‚‰ãŒãªãƒ»ã‚«ã‚¿ã‚«ãƒŠã®å¾Œã«æ¿ç‚¹è¨˜å·ï¼ˆã‚›ã€ï¾ï¼‰ãŒã‚ã‚‹å ´åˆã‚’æ¤œå‡º
- [ ] é’ç©ºæ³¨è¨˜ã§å›²ã‚€
- [ ] `@use_dakuten_font = true` ãƒ•ãƒ©ã‚°ã‚’è¨­å®š

**NarouFormatSettings.java ã«è¿½åŠ **:
```java
private boolean enableDakutenFont = false;
```

---

### 3.11 é•·éŸ³è¨˜å·ã®å¤‰æ›

**å‚è€ƒã‚³ãƒ¼ãƒ‰**: `narou-3.8.2/lib/converterbase.rb:478-486`

**å‡¦ç†å†…å®¹**:
```
ãƒ¼ãƒ¼ â†’ â€•â€•
ãƒ¼ãƒ¼ãƒ¼ â†’ â€•â€•â€•
```

**å®Ÿè£…ã‚¿ã‚¹ã‚¯**:
- [ ] ã‚«ã‚¿ã‚«ãƒŠé•·éŸ³ç¬¦ï¼ˆãƒ¼ï¼‰ã‚’å…¨è§’ãƒ€ãƒƒã‚·ãƒ¥ï¼ˆâ€•ï¼‰ã«å¤‰æ›
- [ ] 2å€‹ä»¥ä¸Šé€£ç¶šã—ã¦ã„ã‚‹å ´åˆã®ã¿

**NarouFormatSettings.java ã«è¿½åŠ **:
```java
private boolean enableProlongedSoundMarkToDash = false;
```

---

### 3.12 æ”¹ãƒšãƒ¼ã‚¸ç›´å¾Œã®è¦‹å‡ºã—åŒ–

**å‚è€ƒã‚³ãƒ¼ãƒ‰**: `narou-3.8.2/lib/converterbase.rb:1248-1283`

**å‡¦ç†å†…å®¹**:
```
ï¼»ï¼ƒæ”¹ãƒšãƒ¼ã‚¸ï¼½
ç¬¬ä¸€ç« 

â†“

ï¼»ï¼ƒæ”¹ãƒšãƒ¼ã‚¸ï¼½
ï¼»ï¼ƒï¼“å­—ä¸‹ã’ï¼½ï¼»ï¼ƒä¸­è¦‹å‡ºã—ï¼½ç¬¬ä¸€ç« ï¼»ï¼ƒä¸­è¦‹å‡ºã—çµ‚ã‚ã‚Šï¼½
```

**å®Ÿè£…ã‚¿ã‚¹ã‚¯**:
- [ ] `ï¼»ï¼ƒæ”¹ãƒšãƒ¼ã‚¸ï¼½` ã®ç›´å¾Œã®è¡Œã‚’è¦‹å‡ºã—ã¨ã—ã¦æ¤œå‡º
- [ ] é’ç©ºæ³¨è¨˜ã‚’è‡ªå‹•æŒ¿å…¥
- [ ] ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›æ™‚ã®ã¿æœ‰åŠ¹

**NarouFormatSettings.java ã«è¿½åŠ **:
```java
private boolean enableEnchantMidashi = true;
```

---

### 3.13 ã‹ãæ‹¬å¼§ã®é–‹é–‰ãƒã‚§ãƒƒã‚¯

**å‚è€ƒã‚³ãƒ¼ãƒ‰**: `narou-3.8.2/lib/converterbase.rb:669-729`

**å‡¦ç†å†…å®¹**:
- ã‹ãæ‹¬å¼§ã®ãƒã‚¹ãƒˆãŒæ­£ã—ã„ã‹ã‚’ãƒã‚§ãƒƒã‚¯
- è­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‡ºåŠ›ï¼ˆã‚¨ãƒ©ãƒ¼ã§ã¯ãªã„ï¼‰

**å®Ÿè£…ã‚¿ã‚¹ã‚¯**:
- [ ] `ã€Œã€` ãªã©ã®é–‹ãæ‹¬å¼§ã¨ `ã€ã€` ãªã©ã®é–‰ã˜æ‹¬å¼§ã®å¯¾å¿œã‚’ãƒã‚§ãƒƒã‚¯
- [ ] ãƒ­ã‚°ã«è­¦å‘Šã‚’å‡ºåŠ›

**NarouFormatSettings.java ã«è¿½åŠ **:
```java
private boolean enableInspectInvalidOpenCloseBrackets = true;
```

---

### 3.14 ãªã‚ã†ç‹¬è‡ªã‚¿ã‚°ã®å‡¦ç†

**å‚è€ƒã‚³ãƒ¼ãƒ‰**: `narou-3.8.2/lib/converterbase.rb:488-518`

**å‡¦ç†å†…å®¹**:
```
[chapter:ç« ã‚¿ã‚¤ãƒˆãƒ«] â†’ ç« ã‚¿ã‚¤ãƒˆãƒ«ã¨ã—ã¦å‡¦ç†
[newpage] â†’ ï¼»ï¼ƒæ”¹ãƒšãƒ¼ã‚¸ï¼½
```

**å®Ÿè£…ã‚¿ã‚¹ã‚¯**:
- [ ] `[chapter:...]` ã‚’ç« ã‚¿ã‚¤ãƒˆãƒ«ã«å¤‰æ›
- [ ] `[newpage]` ã‚’ `ï¼»ï¼ƒæ”¹ãƒšãƒ¼ã‚¸ï¼½` ã«å¤‰æ›
- [ ] ãã®ä»–ã®ã‚¿ã‚°ã‚‚å¯¾å¿œ

---

## ğŸ“ Phase 4: è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«å¯¾å¿œ

### å„ªå…ˆåº¦: â˜… MEDIUM

### 4.1 setting.ini ã®ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½å¼·åŒ–

**ç¾åœ¨ã®å®Ÿè£…**: `NarouFormatSettings.java:40-79`

**è¿½åŠ ã™ã¹ãè¨­å®šé …ç›®**:
```ini
# Phase 3 ã§å®Ÿè£…ã™ã‚‹å…¨ã¦ã®è¨­å®š
enable_convert_num_to_kanji = false
enable_kanji_num_with_units = false
kanji_num_with_units_lower_digit_zero = 2
enable_alphabet_force_zenkaku = false
enable_half_indent_bracket = true
enable_auto_indent = false
enable_auto_join_in_brackets = false
enable_inspect_invalid_openclose_brackets = true
enable_auto_join_line = false
enable_enchant_midashi = true
enable_author_comments = true
enable_erase_introduction = false
enable_erase_postscript = false
enable_ruby = true
enable_narou_illust = true
enable_transform_fraction = false
enable_transform_date = false
date_format = %Yå¹´%mæœˆ%dæ—¥
enable_convert_horizontal_ellipsis = false
enable_dakuten_font = false
enable_prolonged_sound_mark_to_dash = false
```

**ã‚¿ã‚¹ã‚¯**:
- [ ] å…¨ã¦ã®è¨­å®šé …ç›®ã‚’ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«è¿½åŠ 
- [ ] load() ãƒ¡ã‚½ãƒƒãƒ‰ã§èª­ã¿è¾¼ã¿
- [ ] ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’ narou.rb ã«åˆã‚ã›ã‚‹

---

### 4.2 replace.txt ã®å¯¾å¿œ

**å‚è€ƒ**: `narou-3.8.2/lib/converterbase.rb:1159-1172`

**å‡¦ç†å†…å®¹**:
- ãƒ¦ãƒ¼ã‚¶ãƒ¼å®šç¾©ã®ç½®æ›ãƒ«ãƒ¼ãƒ«ã‚’é©ç”¨
- ã‚¿ãƒ–åŒºåˆ‡ã‚Šã§ `æ¤œç´¢æ–‡å­—åˆ—\tç½®æ›æ–‡å­—åˆ—`

**å®Ÿè£…ã‚¿ã‚¹ã‚¯**:
- [ ] replace.txt ã‚’èª­ã¿è¾¼ã‚€
- [ ] å¤‰æ›å‡¦ç†ã®æœ€å¾Œã«é©ç”¨

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆè¨ˆç”»

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹1: åŸºæœ¬å‹•ä½œç¢ºèª

**å¯¾è±¡å°èª¬**: ãªã‚ã†çŸ­ç·¨ï¼ˆãƒ«ãƒ“ãƒ»æ”¹è¡Œãƒ»è¡¨ç´™ã‚ã‚Šï¼‰

**ç¢ºèªé …ç›®**:
- [ ] ãƒ«ãƒ“ãŒ `ï½œæ¼¢å­—ã€Šã‹ã‚“ã˜ã€‹` å½¢å¼ã«ãªã£ã¦ã„ã‚‹
- [ ] ç©ºç™½è¡ŒãŒå¢—ãˆã¦ã„ãªã„
- [ ] è¡¨ç´™ãŒ `cover.jpg` ã¨ã—ã¦å‡ºåŠ›ã•ã‚Œã¦ã„ã‚‹
- [ ] converted.txt ã®3è¡Œç›®ã« `ï¼»ï¼ƒæŒ¿çµµï¼ˆcover.jpgï¼‰å…¥ã‚‹ï¼½` ãŒã‚ã‚‹

---

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹2: è¤‡é›‘ãªå¤‰æ›

**å¯¾è±¡å°èª¬**: ãªã‚ã†é€£è¼‰ï¼ˆæ•°å­—ã€è‹±æ–‡ã€è¨˜å·ã€ç‰¹æ®Šæ–‡å­—å¤šæ•°ï¼‰

**ç¢ºèªé …ç›®**:
- [ ] æ•°å­—ãŒæ¼¢æ•°å­—åŒ–ã•ã‚Œã¦ã„ã‚‹ï¼ˆenable_convert_num_to_kanji = true ã®å ´åˆï¼‰
- [ ] è‹±æ–‡ãŒåŠè§’ã®ã¾ã¾ä¿è­·ã•ã‚Œã¦ã„ã‚‹
- [ ] ã‹ãæ‹¬å¼§ã«äºŒåˆ†ã‚¢ã‚­ãŒå…¥ã£ã¦ã„ã‚‹
- [ ] ç¸¦ä¸­æ¨ªãŒé©ç”¨ã•ã‚Œã¦ã„ã‚‹ï¼ˆ`ï¼ï¼` ãªã©ï¼‰

---

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹3: narou.rb ã¨ã®å‡ºåŠ›æ¯”è¼ƒ

**æ‰‹é †**:
1. åŒã˜å°èª¬ã‚’ narou.rb ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
2. WebAozoraConverter.java ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
3. ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ diff ã§æ¯”è¼ƒ
4. å·®åˆ†ã‚’ç¢ºèªã—ã¦èª¿æ•´

**ç›®æ¨™**: å·®åˆ†ãŒè¨­å®šã®é•ã„ï¼ˆæœ‰åŠ¹/ç„¡åŠ¹ï¼‰ã®ã¿ã«ãªã‚‹ã“ã¨

---

## ğŸ“‚ ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

### æ–°è¦ä½œæˆãƒ•ã‚¡ã‚¤ãƒ«

```
src/com/github/hmdev/converter/
  â”œâ”€â”€ TextConverter.java          # ãƒ†ã‚­ã‚¹ãƒˆå¤‰æ›ã®å…±é€šå‡¦ç†
  â”œâ”€â”€ NumberConverter.java        # æ•°å­—å¤‰æ›
  â”œâ”€â”€ RubyConverter.java          # ãƒ«ãƒ“å¤‰æ›
  â”œâ”€â”€ SymbolConverter.java        # è¨˜å·å¤‰æ›
  â””â”€â”€ BracketProcessor.java       # ã‹ãæ‹¬å¼§å‡¦ç†
```

### ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«

```
src/com/github/hmdev/web/
  â”œâ”€â”€ WebAozoraConverter.java     # ãƒ¡ã‚¤ãƒ³å¤‰æ›ã‚¯ãƒ©ã‚¹ï¼ˆå¤§å¹…ä¿®æ­£ï¼‰
  â””â”€â”€ NarouFormatSettings.java    # è¨­å®šç®¡ç†ï¼ˆè¨­å®šé …ç›®è¿½åŠ ï¼‰
```

---

## ğŸ”„ å¤‰æ›å‡¦ç†ãƒ•ãƒ­ãƒ¼ï¼ˆå®Œæˆç‰ˆï¼‰

```
1. HTMLãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
   â†“
2. ãƒ«ãƒ“ã‚¿ã‚°å¤‰æ›ï¼ˆruby â†’ ï½œã€Šã€‹ï¼‰
   â†“
3. HTMLæ”¹è¡Œå‰Šé™¤ï¼ˆ\r\n â†’ ""ï¼‰
   â†“
4. brã‚¿ã‚°å¤‰æ›ï¼ˆ<br> â†’ \nï¼‰
   â†“
5. pã‚¿ã‚°å¤‰æ›ï¼ˆ</p> â†’ \nï¼‰
   â†“
6. æ—¢å­˜ã®å±±æ‹¬å¼§é€€é¿ï¼ˆã€Šã€‹ â†’ â‰ªâ‰«ï¼‰
   â†“
7. è‹±æ–‡ä¿è­·ï¼ˆè‹±æ–‡ â†’ ï¼»ï¼ƒè‹±æ–‡ï¼Nï¼½ï¼‰
   â†“
8. æ¼¢æ•°å­—é€€é¿ï¼ˆæ¼¢æ•°å­— â†’ ï¼»ï¼ƒæ¼¢æ•°å­—ï¼Nï¼½ï¼‰
   â†“
9. ã‚«ãƒ³ãƒæ•°å­—é€€é¿ï¼ˆ1,000 â†’ ï¼»ï¼ƒåŠè§’æ•°å­—ï¼Nï¼½ï¼‰
   â†“
10. ã‚¢ãƒ©ãƒ“ã‚¢æ•°å­—â†’æ¼¢æ•°å­—ï¼ˆ123 â†’ ä¸€äºŒä¸‰ï¼‰
   â†“
11. åƒãƒ»ä¸‡ãªã©ã®å˜ä½åŒ–ï¼ˆ1000 â†’ åƒï¼‰
   â†“
12. è¨˜å·å…¨è§’åŒ–ï¼ˆ- â†’ ï¼ï¼‰
   â†“
13. åˆ†æ•°å¤‰æ›ï¼ˆ1/2 â†’ 2åˆ†ã®1ï¼‰
   â†“
14. æ—¥ä»˜å¤‰æ›ï¼ˆ2024/1/1 â†’ 2024å¹´1æœˆ1æ—¥ï¼‰
   â†“
15. ãƒ­ãƒ¼ãƒæ•°å­—å¤‰æ›ï¼ˆâ…  â†’ Iï¼‰
   â†“
16. é•·éŸ³è¨˜å·å¤‰æ›ï¼ˆãƒ¼ãƒ¼ â†’ â€•â€•ï¼‰
   â†“
17. ä¸‰ç‚¹ãƒªãƒ¼ãƒ€ãƒ¼å¤‰æ›ï¼ˆãƒ»ãƒ»ãƒ» â†’ â€¦â€¦ï¼‰
   â†“
18. æ¿ç‚¹ãƒ•ã‚©ãƒ³ãƒˆå‡¦ç†ï¼ˆã‹ã‚› â†’ ï¼»ï¼ƒæ¿ç‚¹ï¼½ã‹ï¼»ï¼ƒæ¿ç‚¹çµ‚ã‚ã‚Šï¼½ï¼‰
   â†“
19. ç¸¦ä¸­æ¨ªå‡¦ç†ï¼ˆï¼ï¼ â†’ ï¼»ï¼ƒç¸¦ä¸­æ¨ªï¼½!!ï¼»ï¼ƒç¸¦ä¸­æ¨ªçµ‚ã‚ã‚Šï¼½ï¼‰
   â†“
20. ã‹ãæ‹¬å¼§äºŒåˆ†ã‚¢ã‚­ï¼ˆã€Œ â†’ ï¼»ï¼ƒäºŒåˆ†ã‚¢ã‚­ï¼½ã€Œï¼‰
   â†“
21. ã‹ãæ‹¬å¼§å†…é€£çµï¼ˆæ”¹è¡Œå‰Šé™¤ï¼‰
   â†“
22. è¡Œæœ«èª­ç‚¹é€£çµ
   â†“
23. å‰æ›¸ããƒ»å¾Œæ›¸ãæ¤œå‡ºï¼ˆæ³¨è¨˜æŒ¿å…¥ï¼‰
   â†“
24. æ”¹ãƒšãƒ¼ã‚¸å¾Œã®è¦‹å‡ºã—åŒ–
   â†“
25. è‹±æ–‡å¾©å…ƒï¼ˆï¼»ï¼ƒè‹±æ–‡ï¼Nï¼½ â†’ è‹±æ–‡ï¼‰
   â†“
26. æ¼¢æ•°å­—å¾©å…ƒï¼ˆï¼»ï¼ƒæ¼¢æ•°å­—ï¼Nï¼½ â†’ æ¼¢æ•°å­—ï¼‰
   â†“
27. åŠè§’æ•°å­—å¾©å…ƒï¼ˆï¼»ï¼ƒåŠè§’æ•°å­—ï¼Nï¼½ â†’ 1,000ï¼‰
   â†“
28. replace.txt é©ç”¨
   â†“
29. ãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ›
```

---

## ğŸ“Š å®Ÿè£…å„ªå…ˆåº¦ãƒãƒˆãƒªã‚¯ã‚¹

| æ©Ÿèƒ½ | å„ªå…ˆåº¦ | å®Ÿè£…é›£æ˜“åº¦ | å½±éŸ¿ç¯„å›² | æ¨å®šå·¥æ•° |
|-----|-------|-----------|---------|---------|
| æ”¹è¡Œå‡¦ç† | â˜…â˜…â˜… | ä½ | å…¨ä½“ | 0.5h |
| è¡¨ç´™æŒ¿çµµæ³¨è¨˜ | â˜…â˜…â˜… | ä½ | è¡¨ç´™ã®ã¿ | 0.5h |
| ãƒ«ãƒ“å¤‰æ› | â˜…â˜…â˜… | ä¸­ | å…¨ä½“ | 1h |
| äºŒåˆ†ã‚¢ã‚­ | â˜…â˜… | ä½ | è¦‹ãŸç›® | 0.5h |
| è‹±æ–‡ä¿è­· | â˜…â˜… | ä¸­ | å…¨ä½“ | 1h |
| ç¸¦ä¸­æ¨ª | â˜…â˜… | ä½ | è¦‹ãŸç›® | 0.5h |
| æ•°å­—æ¼¢æ•°å­—åŒ– | â˜… | é«˜ | å…¨ä½“ | 3h |
| å‰æ›¸ãæ¤œå‡º | â˜… | ä¸­ | æ§‹é€  | 1.5h |
| è¨˜å·å…¨è§’åŒ– | â˜… | ä½ | å…¨ä½“ | 0.5h |
| ã‹ãæ‹¬å¼§é€£çµ | â˜… | é«˜ | å…¨ä½“ | 2h |
| è¡Œæœ«èª­ç‚¹é€£çµ | â˜… | ä¸­ | å…¨ä½“ | 1h |
| åˆ†æ•°å¤‰æ› | â˜… | ä½ | éƒ¨åˆ† | 0.5h |
| æ—¥ä»˜å¤‰æ› | â˜… | ä½ | éƒ¨åˆ† | 0.5h |
| ä¸‰ç‚¹ãƒªãƒ¼ãƒ€ãƒ¼ | â˜… | ä½ | è¦‹ãŸç›® | 0.5h |
| æ¿ç‚¹ãƒ•ã‚©ãƒ³ãƒˆ | â˜… | ä½ | éƒ¨åˆ† | 0.5h |
| é•·éŸ³è¨˜å· | â˜… | ä½ | éƒ¨åˆ† | 0.5h |
| è¦‹å‡ºã—åŒ– | â˜… | ä¸­ | æ§‹é€  | 1h |
| æ‹¬å¼§ãƒã‚§ãƒƒã‚¯ | â˜… | ä¸­ | æ¤œè¨¼ | 1h |
| ãªã‚ã†ã‚¿ã‚° | â˜… | ä½ | éƒ¨åˆ† | 0.5h |
| **åˆè¨ˆ** | | | | **17h** |

---

## ğŸš€ å®Ÿè£…ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆæ¨å¥¨ï¼‰

### Day 1: Phase 1ï¼ˆç·Šæ€¥ä¿®æ­£ï¼‰

- [ ] æ”¹è¡Œå‡¦ç†ã®ä¿®æ­£ï¼ˆ30åˆ†ï¼‰
- [ ] è¡¨ç´™æŒ¿çµµæ³¨è¨˜ï¼ˆ30åˆ†ï¼‰
- [ ] ãƒ«ãƒ“å¤‰æ›ï¼ˆ1æ™‚é–“ï¼‰
- [ ] ãƒ†ã‚¹ãƒˆï¼†ãƒ‡ãƒãƒƒã‚°ï¼ˆ1æ™‚é–“ï¼‰

**åˆè¨ˆ**: 3æ™‚é–“

---

### Day 2: Phase 2ï¼ˆå“è³ªå‘ä¸Šï¼‰

- [ ] äºŒåˆ†ã‚¢ã‚­ï¼ˆ30åˆ†ï¼‰
- [ ] è‹±æ–‡ä¿è­·ï¼ˆ1æ™‚é–“ï¼‰
- [ ] ç¸¦ä¸­æ¨ªï¼ˆ30åˆ†ï¼‰
- [ ] ãƒ†ã‚¹ãƒˆï¼†ãƒ‡ãƒãƒƒã‚°ï¼ˆ1æ™‚é–“ï¼‰

**åˆè¨ˆ**: 3æ™‚é–“

---

### Day 3-4: Phase 3ï¼ˆé«˜åº¦ãªå¤‰æ›ï¼‰

- [ ] æ•°å­—æ¼¢æ•°å­—åŒ–ï¼ˆ3æ™‚é–“ï¼‰
- [ ] å‰æ›¸ããƒ»å¾Œæ›¸ãæ¤œå‡ºï¼ˆ1.5æ™‚é–“ï¼‰
- [ ] ã‹ãæ‹¬å¼§å†…é€£çµï¼ˆ2æ™‚é–“ï¼‰
- [ ] è¡Œæœ«èª­ç‚¹é€£çµï¼ˆ1æ™‚é–“ï¼‰
- [ ] è¨˜å·å…¨è§’åŒ–ï¼ˆ30åˆ†ï¼‰
- [ ] ãã®ä»–ã®å¤‰æ›ï¼ˆ2æ™‚é–“ï¼‰
- [ ] ãƒ†ã‚¹ãƒˆï¼†ãƒ‡ãƒãƒƒã‚°ï¼ˆ2æ™‚é–“ï¼‰

**åˆè¨ˆ**: 12æ™‚é–“

---

### Day 5: Phase 4ï¼ˆè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ï¼†æœ€çµ‚èª¿æ•´ï¼‰

- [ ] è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«å…¨é …ç›®å¯¾å¿œï¼ˆ1æ™‚é–“ï¼‰
- [ ] replace.txt å¯¾å¿œï¼ˆ1æ™‚é–“ï¼‰
- [ ] narou.rb ã¨ã®å‡ºåŠ›æ¯”è¼ƒï¼ˆ2æ™‚é–“ï¼‰
- [ ] å·®åˆ†èª¿æ•´ï¼ˆ2æ™‚é–“ï¼‰
- [ ] æœ€çµ‚ãƒ†ã‚¹ãƒˆï¼ˆ2æ™‚é–“ï¼‰

**åˆè¨ˆ**: 8æ™‚é–“

---

## âœ… ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆï¼ˆå®Ÿè£…å®Œäº†æ™‚ï¼‰

### Phase 1
- [ ] ç©ºç™½è¡ŒãŒå¢—ãˆã‚‹å•é¡Œã‚’è§£æ±º
- [ ] è¡¨ç´™ãŒæ¨ªæ›¸ãã§è¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ãƒ«ãƒ“ãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹

### Phase 2
- [ ] ã‹ãæ‹¬å¼§ã«äºŒåˆ†ã‚¢ã‚­ãŒå…¥ã‚‹
- [ ] è‹±æ–‡ãŒåŠè§’ã®ã¾ã¾ä¿è­·ã•ã‚Œã‚‹
- [ ] `ï¼ï¼` ãªã©ãŒç¸¦ä¸­æ¨ªã«ãªã‚‹

### Phase 3
- [ ] æ•°å­—ãŒæ¼¢æ•°å­—åŒ–ã•ã‚Œã‚‹ï¼ˆè¨­å®šæœ‰åŠ¹æ™‚ï¼‰
- [ ] å‰æ›¸ããƒ»å¾Œæ›¸ããŒè‡ªå‹•æ¤œå‡ºã•ã‚Œã‚‹
- [ ] è¨˜å·ãŒå…¨è§’åŒ–ã•ã‚Œã‚‹
- [ ] ã‹ãæ‹¬å¼§å†…ãŒé€£çµã•ã‚Œã‚‹
- [ ] è¡Œæœ«èª­ç‚¹ã§é€£çµã•ã‚Œã‚‹
- [ ] åˆ†æ•°ãƒ»æ—¥ä»˜ãŒå¤‰æ›ã•ã‚Œã‚‹
- [ ] ä¸‰ç‚¹ãƒªãƒ¼ãƒ€ãƒ¼ãŒé©ç”¨ã•ã‚Œã‚‹
- [ ] æ¿ç‚¹ãƒ•ã‚©ãƒ³ãƒˆãŒå‡¦ç†ã•ã‚Œã‚‹
- [ ] é•·éŸ³è¨˜å·ãŒå¤‰æ›ã•ã‚Œã‚‹

### Phase 4
- [ ] setting.ini ã®å…¨é …ç›®ãŒèª­ã¿è¾¼ã‚ã‚‹
- [ ] replace.txt ãŒé©ç”¨ã•ã‚Œã‚‹
- [ ] narou.rb ã¨ã®å‡ºåŠ›ãŒä¸€è‡´ã™ã‚‹ï¼ˆè¨­å®šåŒä¸€æ™‚ï¼‰

---

## ğŸ“š å‚è€ƒè³‡æ–™

### narou.rb ã®ä¸»è¦ãƒ•ã‚¡ã‚¤ãƒ«
```
/c/Ruby32-x64/lib/ruby/gems/3.2.0/gems/narou-3.8.2/
  â”œâ”€â”€ lib/
  â”‚   â”œâ”€â”€ converterbase.rb        # ãƒ¡ã‚¤ãƒ³å¤‰æ›ã‚¨ãƒ³ã‚¸ãƒ³
  â”‚   â”œâ”€â”€ novelconverter.rb       # å°èª¬å¤‰æ›åˆ¶å¾¡
  â”‚   â”œâ”€â”€ html.rb                 # HTMLã‚¿ã‚°å¤‰æ›
  â”‚   â”œâ”€â”€ downloader.rb           # ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å‡¦ç†
  â”‚   â””â”€â”€ novelsetting.rb         # è¨­å®šç®¡ç†
  â”œâ”€â”€ preset/
  â”‚   â””â”€â”€ ncode.syosetu.com/
  â”‚       â””â”€â”€ */setting.ini       # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®š
  â””â”€â”€ webnovel/
      â””â”€â”€ ncode.syosetu.com.yaml  # ã‚µã‚¤ãƒˆå®šç¾©
```

### é’ç©ºæ–‡åº«æ³¨è¨˜ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹
- https://www.aozora.gr.jp/annotation/

### AozoraEpub3
- https://github.com/kyukyunyorituryo/AozoraEpub3

---

## ğŸ› æ—¢çŸ¥ã®å•é¡Œãƒ»åˆ¶ç´„

### 1. HTMLãƒ‘ãƒ¼ã‚µãƒ¼ã®åˆ¶é™
- Jsoup ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ãŸã‚ã€ä¸æ­£ãªHTMLã§ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹å¯èƒ½æ€§
- narou.rb ã¯ Nokogiriï¼ˆã‚ˆã‚ŠæŸ”è»Ÿï¼‰ã‚’ä½¿ç”¨

### 2. æ­£è¦è¡¨ç¾ã®é•ã„
- Java ã¨ Ruby ã®æ­£è¦è¡¨ç¾ã«è‹¥å¹²ã®é•ã„ã‚ã‚Š
- ç‰¹ã« Unicode ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®æ‰±ã„ãŒç•°ãªã‚‹

### 3. æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°
- Windowsç’°å¢ƒã§ã®æ–‡å­—åŒ–ã‘ã«æ³¨æ„
- UTF-8 BOM ã®æ‰±ã„ã‚’çµ±ä¸€

### 4. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
- æ­£è¦è¡¨ç¾ã®å¤šç”¨ã«ã‚ˆã‚Šå‡¦ç†ãŒé‡ããªã‚‹å¯èƒ½æ€§
- å¤§é‡ã®è©±æ•°ãŒã‚ã‚‹å°èª¬ã§ã¯æœ€é©åŒ–ãŒå¿…è¦

---

## ğŸ“ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### å•é¡Œ: ãƒ«ãƒ“ãŒäºŒé‡ã«å¤‰æ›ã•ã‚Œã‚‹
**åŸå› **: HTMLãƒ‘ãƒ¼ã‚¹å‰ã¨å¾Œã§2å›å¤‰æ›ã—ã¦ã„ã‚‹
**è§£æ±º**: convertRubyTags() ã®å‘¼ã³å‡ºã—ã‚’1ç®‡æ‰€ã«ã¾ã¨ã‚ã‚‹

### å•é¡Œ: è‹±æ–‡ãŒå…¨è§’åŒ–ã•ã‚Œã¦ã—ã¾ã†
**åŸå› **: è‹±æ–‡ä¿è­·ãŒæ©Ÿèƒ½ã—ã¦ã„ãªã„
**è§£æ±º**: protectEnglishSentences() ã‚’æœ€åˆã«å®Ÿè¡Œ

### å•é¡Œ: ã‹ãæ‹¬å¼§ã®å¯¾å¿œãŒå´©ã‚Œã‚‹
**åŸå› **: é€£çµå‡¦ç†ã§ãƒã‚¹ãƒˆã‚’è€ƒæ…®ã—ã¦ã„ãªã„
**è§£æ±º**: ã‚¹ã‚¿ãƒƒã‚¯æ§‹é€ ã§æ‹¬å¼§ã®æ·±ã•ã‚’ç®¡ç†

### å•é¡Œ: æ•°å­—ãŒæ¼¢æ•°å­—åŒ–ã•ã‚Œãªã„
**åŸå› **: æ—¢å­˜ã®æ¼¢æ•°å­—ã‚’é€€é¿ã—ã¦ã„ãªã„
**è§£æ±º**: stashKanjiNum() ã‚’æœ€åˆã«å®Ÿè¡Œ

---

## ğŸ”š å®Œæˆã®å®šç¾©

ä»¥ä¸‹ã®å…¨ã¦ã‚’æº€ãŸã™ã“ã¨ï¼š

1. âœ… Phase 1 ã®3ã¤ã®å•é¡ŒãŒè§£æ±ºã•ã‚Œã¦ã„ã‚‹
2. âœ… narou.rb ã® setting.ini ã®å…¨é …ç›®ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
3. âœ… åŒã˜è¨­å®šã§å¤‰æ›ã—ãŸå ´åˆã€narou.rb ã¨åŒä¸€ã®å‡ºåŠ›ã«ãªã‚‹
4. âœ… ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ãŒå…¨ã¦é€šéã™ã‚‹
5. âœ… ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒæ•´å‚™ã•ã‚Œã¦ã„ã‚‹

---

**æœ€çµ‚æ›´æ–°**: 2026-02-14
**ä½œæˆè€…**: Claude (Sonnet 4.5)
**ãƒ¬ãƒ“ãƒ¥ãƒ¼**: æœªå®Ÿæ–½
